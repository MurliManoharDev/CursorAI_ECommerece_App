<div class="checkout-container">
  <!-- Breadcrumb -->
  <nav class="breadcrumb-nav">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
      <li class="breadcrumb-item"><a routerLink="/">pages</a></li>
      <li class="breadcrumb-item active">checkout</li>
    </ol>
  </nav>

  <div class="checkout-content">
    <h1 class="page-title">checkout</h1>

    <!-- Alert Boxes -->
    <div class="alert-box login-alert" [class.expanded]="showLoginAlert">
      <div class="alert-header" (click)="toggleLoginAlert()" (keydown.enter)="toggleLoginAlert()" tabindex="0" role="button">
        <i class="fas fa-info-circle"></i>
        <span>Returning customer? Click here to log in</span>
      </div>
      <div class="alert-content" *ngIf="showLoginAlert">
        <p>If you have shopped with us before, please enter your details below. If you are a new customer, please proceed to the Billing section.</p>
        <div class="login-form">
          <input type="email" placeholder="Email address" class="form-control">
          <input type="password" placeholder="Password" class="form-control">
          <button class="btn btn-primary">Login</button>
        </div>
      </div>
    </div>

    <div class="alert-box coupon-alert" [class.expanded]="showCouponAlert">
      <div class="alert-header" (click)="toggleCouponAlert()" (keydown.enter)="toggleCouponAlert()" tabindex="0" role="button">
        <i class="fas fa-tag"></i>
        <span>Have a coupon? Click here to enter your code</span>
      </div>
      <div class="alert-content" *ngIf="showCouponAlert">
        <div class="coupon-form">
          <input type="text" placeholder="Coupon code" class="form-control">
          <button class="btn btn-primary">Apply Coupon</button>
        </div>
      </div>
    </div>

    <div class="checkout-main">
      <!-- Billing Details Form -->
      <div class="billing-section">
        <h2>Billing Detail</h2>
        
        <form [formGroup]="checkoutForm">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" class="form-control" formControlName="firstName"
                     [class.is-invalid]="checkoutForm.get('firstName')?.touched && checkoutForm.get('firstName')?.invalid">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('firstName')?.touched && checkoutForm.get('firstName')?.invalid">
                First name is required (minimum 2 characters)
              </div>
            </div>
            <div class="form-group col-md-6">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" class="form-control" formControlName="lastName"
                     [class.is-invalid]="checkoutForm.get('lastName')?.touched && checkoutForm.get('lastName')?.invalid">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('lastName')?.touched && checkoutForm.get('lastName')?.invalid">
                Last name is required (minimum 2 characters)
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="companyName">Company Name (Optional)</label>
            <input type="text" id="companyName" class="form-control" formControlName="companyName">
          </div>

          <div class="form-group">
            <label for="country">Country / Region *</label>
            <select id="country" class="form-control custom-select" formControlName="country">
              <option *ngFor="let country of countries" [value]="country.code">
                {{country.name}}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="streetAddress">Street Address</label>
            <input type="text" id="streetAddress" class="form-control mb-3" formControlName="streetAddress" 
                   placeholder="House number and street name ..."
                   [class.is-invalid]="checkoutForm.get('streetAddress')?.touched && checkoutForm.get('streetAddress')?.invalid">
            <input type="text" class="form-control" formControlName="apartmentSuite" 
                   placeholder="Apartment, suite, unit, etc (Optional)">
            <div class="invalid-feedback" *ngIf="checkoutForm.get('streetAddress')?.touched && checkoutForm.get('streetAddress')?.invalid">
              Street address is required
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="city">Town / City *</label>
              <input type="text" id="city" class="form-control" formControlName="city"
                     [class.is-invalid]="checkoutForm.get('city')?.touched && checkoutForm.get('city')?.invalid">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('city')?.touched && checkoutForm.get('city')?.invalid">
                City is required
              </div>
            </div>
            <div class="form-group col-md-6">
              <label for="state">State / County *</label>
              <select id="state" class="form-control custom-select" formControlName="state">
                <option *ngFor="let state of states" [value]="state.code">
                  {{state.name}}
                </option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="zipCode">Zip Code *</label>
            <input type="text" id="zipCode" class="form-control" formControlName="zipCode"
                   [class.is-invalid]="checkoutForm.get('zipCode')?.touched && checkoutForm.get('zipCode')?.invalid">
                          <div class="invalid-feedback" *ngIf="checkoutForm.get('zipCode')?.touched && checkoutForm.get('zipCode')?.invalid">
                Valid postal/zip code is required (minimum 3 characters)
              </div>
          </div>

          <div class="form-group">
            <label for="phoneNumber">Phone Number *</label>
            <input type="tel" id="phoneNumber" class="form-control" formControlName="phoneNumber"
                   [class.is-invalid]="checkoutForm.get('phoneNumber')?.touched && checkoutForm.get('phoneNumber')?.invalid">
            <div class="invalid-feedback" *ngIf="checkoutForm.get('phoneNumber')?.touched && checkoutForm.get('phoneNumber')?.invalid">
              Valid phone number is required
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email Address *</label>
            <input type="email" id="email" class="form-control" formControlName="email"
                   [class.is-invalid]="checkoutForm.get('email')?.touched && checkoutForm.get('email')?.invalid">
            <div class="invalid-feedback" *ngIf="checkoutForm.get('email')?.touched && checkoutForm.get('email')?.invalid">
              Valid email address is required
            </div>
          </div>

          <div class="form-check mb-4">
            <input type="checkbox" class="form-check-input" id="createAccount" 
                   [(ngModel)]="isCreatingAccount" [ngModelOptions]="{standalone: true}">
            <label class="form-check-label" for="createAccount">
              Create an account?
            </label>
          </div>
        </form>

        <!-- Additional Information -->
        <h2 class="mt-5">Additional Information</h2>
        <div class="form-group">
          <label for="orderNotes">Order Notes (Optional)</label>
          <textarea id="orderNotes" class="form-control" rows="4" [(ngModel)]="orderNotes"
                    placeholder="Note about your order, e.g. special note for delivery"></textarea>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-section">
        <h2>Your Order</h2>
        
        <div class="order-card">
          <div class="order-header">
            <span>Product</span>
            <span>sub total</span>
          </div>
          
          <div class="order-items" *ngIf="cartItems$ | async as cartItems">
            <div class="order-item" *ngFor="let item of cartItems">
              <img [src]="item.image" [alt]="item.name" class="item-image">
              <div class="item-details">
                <h4>{{item.name}}</h4>
                <span class="quantity">x {{item.quantity}}</span>
              </div>
              <div class="item-price">
                <span class="price">${{(item.price * item.quantity).toFixed(2)}}</span>
                <span class="shipping" *ngIf="item.shippingCost">
                  {{item.shipping}}
                  <span class="shipping-cost"> + ${{item.shippingCost.toFixed(2)}}</span>
                </span>
                <span class="shipping" *ngIf="!item.shippingCost && item.shipping">
                  {{item.shipping}}
                </span>
              </div>
            </div>
          </div>
          
          <div class="order-total">
            <span>Subtotal</span>
            <span class="amount">${{((cartSummary$ | async)?.subtotal || 0).toFixed(2)}}</span>
          </div>
          <div class="order-total">
            <span>Shipping</span>
            <span class="amount">${{getShippingCost().toFixed(2)}}</span>
          </div>
          <div class="order-total">
            <span>Tax</span>
            <span class="amount">${{getTax().toFixed(2)}}</span>
          </div>
          <div class="order-total">
            <span>Order Total</span>
            <span class="total-amount">${{getOrderTotal().toFixed(2)}}</span>
          </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-card">
          <div class="payment-method" [class.selected]="selectedPaymentMethod === 'card'">
            <div class="method-header" (click)="selectPaymentMethod('card')" (keydown.enter)="selectPaymentMethod('card')" tabindex="0" role="button">
              <input type="radio" name="payment" [checked]="selectedPaymentMethod === 'card'">
              <h3>Credit/Debit Card</h3>
              <span class="card-icons">
                <i class="fab fa-cc-visa"></i>
                <i class="fab fa-cc-mastercard"></i>
                <i class="fab fa-cc-amex"></i>
              </span>
            </div>
            <div class="method-content" *ngIf="selectedPaymentMethod === 'card'">
              <div class="stripe-card-element" #cardElement></div>
              <p class="card-info">Your card information is securely processed by Stripe</p>
              <div class="payment-error" *ngIf="paymentError">
                <i class="fas fa-exclamation-circle"></i>
                {{paymentError}}
              </div>
            </div>
          </div>

          <div class="payment-method" [class.selected]="selectedPaymentMethod === 'bank-transfer'">
            <div class="method-header" (click)="selectPaymentMethod('bank-transfer')" (keydown.enter)="selectPaymentMethod('bank-transfer')" tabindex="0" role="button">
              <input type="radio" name="payment" [checked]="selectedPaymentMethod === 'bank-transfer'">
              <h3>Direct Bank Transfer</h3>
            </div>
            <div class="method-content" *ngIf="selectedPaymentMethod === 'bank-transfer'">
              <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.</p>
            </div>
          </div>

          <div class="payment-method" [class.selected]="selectedPaymentMethod === 'cod'">
            <div class="method-header" (click)="selectPaymentMethod('cod')" (keydown.enter)="selectPaymentMethod('cod')" tabindex="0" role="button">
              <input type="radio" name="payment" [checked]="selectedPaymentMethod === 'cod'">
              <h3>Cash on Delivery</h3>
            </div>
          </div>

          <div class="payment-method" [class.selected]="selectedPaymentMethod === 'paypal'">
            <div class="method-header" (click)="selectPaymentMethod('paypal')" (keydown.enter)="selectPaymentMethod('paypal')" tabindex="0" role="button">
              <input type="radio" name="payment" [checked]="selectedPaymentMethod === 'paypal'">
              <h3>Paypal</h3>
              <a href="#" class="paypal-link">What's Paypal?</a>
              <span class="paypal-logo">PayPal</span>
            </div>
          </div>

          <button class="btn btn-place-order" (click)="placeOrder()" [disabled]="isProcessing">
            <span *ngIf="!isProcessing">place order</span>
            <span *ngIf="isProcessing">
              <i class="fas fa-spinner fa-spin"></i> Processing...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 